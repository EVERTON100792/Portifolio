document.addEventListener('DOMContentLoaded', () => {

    /* ==========================================================================
       CONTEÚDO DOS ARTIGOS DO BLOG
       ========================================================================== */
    const articleContents = {
        article1: {
            title: 'Landing Page vs. Site Institucional: Qual o melhor para seu negócio?',
            body: `
                <p>Muitos empreendedores ficam na dúvida na hora de investir na sua presença online: "Eu preciso de um site completo ou apenas uma página resolve?". A resposta é: depende do seu <strong>objetivo</strong>. Entender a função de cada um é o primeiro passo para investir seu dinheiro da forma mais inteligente possível.</p>
                <p>Vamos desmistificar isso de uma vez por todas.</p>
                
                <h3>O que é um Site Institucional? (O Alicerce da sua Presença Online)</h3>
                <p>Pense no Site Institucional como a <strong>sede digital da sua empresa</strong>. É o seu endereço principal na internet, o lugar onde clientes, parceiros e futuros colaboradores vão para saber tudo sobre você de forma completa e confiável.</p>
                <ul>
                    <li><strong>Objetivo Principal:</strong> Construir autoridade, credibilidade e oferecer um panorama completo do seu negócio.</li>
                    <li><strong>Estrutura:</strong> Possui várias páginas, como Home, Sobre Nós, Serviços, Blog e Contato.</li>
                    <li><strong>Ideal para:</strong> Empresas que desejam consolidar sua marca a longo prazo, apresentar um portfólio variado e ser uma fonte de referência em seu mercado.</li>
                </ul>

                <h3>O que é uma Landing Page? (A Ferramenta de Conversão)</h3>
                <p>Se o site é a sede, a Landing Page é o seu <strong>vendedor especialista com uma única missão</strong>. Ela é uma página única, 100% focada em fazer o visitante tomar <strong>uma ação específica</strong>.</p>
                 <ul>
                    <li><strong>Objetivo Principal:</strong> Conversão. Seja capturar um e-mail, vender um produto específico, inscrever para um evento ou agendar uma demonstração.</li>
                    <li><strong>Estrutura:</strong> Uma única página, sem menu de navegação ou links que possam distrair o usuário.</li>
                    <li><strong>Ideal para:</strong> Campanhas de marketing (Google Ads, Facebook Ads), lançamento de um novo produto ou serviço ou inscrições para webinars.</li>
                </ul>

                <h3>Tabela Comparativa Rápida</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Característica</th>
                            <th>Site Institucional</th>
                            <th>Landing Page</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Objetivo</strong></td>
                            <td>Construir marca e informar</td>
                            <td>Gerar uma ação específica (conversão)</td>
                        </tr>
                        <tr>
                            <td><strong>Páginas</strong></td>
                            <td>Múltiplas</td>
                            <td>Apenas uma</td>
                        </tr>
                         <tr>
                            <td><strong>Navegação</strong></td>
                            <td>Menu completo</td>
                            <td>Nenhum ou mínimo</td>
                        </tr>
                         <tr>
                            <td><strong>Foco</strong></td>
                            <td>Amplo e informativo</td>
                            <td>Único e direto ao ponto</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Conclusão: Um não anula o outro!</h3>
                <p>A melhor estratégia, na maioria das vezes, é usar os dois em conjunto. O <strong>Site Institucional</strong> funciona como sua base sólida, construindo a confiança na sua marca. As <strong>Landing Pages</strong> são as ferramentas de ataque que você usa para suas campanhas de marketing, trazendo resultados rápidos e mensuráveis.</p>
                
                <div class="cta-final">
                    <p>Ficou na dúvida sobre qual é a melhor estratégia para o seu momento atual? Vamos conversar! Eu posso ajudar a diagnosticar sua necessidade e propor a solução com o melhor retorno sobre o investimento.</p>
                </div>
            `
        },
        article2: {
            title: 'Como a velocidade do seu site impacta diretamente suas vendas',
            body: `
                <p>Você sabia que, segundo o Google, <strong>53% dos usuários de celular abandonam um site que demora mais de 3 segundos para carregar</strong>? Três segundos. Esse é o tempo que você tem para não perder mais da metade dos seus potenciais clientes.</p>
                <p>Velocidade não é um luxo técnico, é um pilar fundamental para o sucesso de qualquer negócio online. Vamos ver como ela afeta seu bolso.</p>

                <h3>1. A Primeira Impressão (e o Custo da Frustração)</h3>
                <p>Seu site é, muitas vezes, o primeiro contato que um cliente tem com sua marca. Um carregamento lento cria uma primeira impressão de amadorismo e descaso. A frustração gerada faz com que o usuário associe sua marca a uma experiência negativa, mesmo antes de conhecer seu produto ou serviço. O resultado? Ele fecha a aba e vai para o seu concorrente, que provavelmente tem um site mais rápido.</p>

                <h3>2. O Google Ama Velocidade (e Recompensa quem a tem)</h3>
                <p>O Google tem uma missão clara: entregar os melhores resultados para seus usuários. E um site lento é uma péssima experiência. Por isso, a velocidade de carregamento (medida pelos <strong>Core Web Vitals</strong>) é um dos fatores mais importantes para o ranqueamento no sistema de busca.</p>
                <ul>
                    <li><strong>Site Rápido:</strong> Sobe nas posições do Google, é encontrado por mais pessoas e recebe mais tráfego orgânico (gratuito).</li>
                    <li><strong>Site Lento:</strong> É penalizado pelo Google, fica escondido nas páginas seguintes e se torna praticamente invisível para novos clientes.</li>
                </ul>

                <h3>3. O Impacto Direto no Bolso: A Taxa de Conversão</h3>
                <p>É aqui que o prejuízo se torna mais claro. "Conversão" é a ação que você quer que o usuário realize: preencher um formulário, comprar um produto, ligar para você. Um site lento destrói suas taxas de conversão.</p>
                 <ul>
                    <li><strong>Aumento da Taxa de Rejeição:</strong> As pessoas saem antes mesmo de ver sua oferta.</li>
                    <li><strong>Queda na Conversão:</strong> Mesmo os que ficam, já frustrados, têm muito menos probabilidade de finalizar uma compra ou enviar um contato.</li>
                    <li><strong>Prejuízo em Anúncios Pagos:</strong> Se você investe em Google Ads ou Facebook Ads, está pagando para levar tráfego a uma página que espanta os visitantes. É literalmente queimar dinheiro.</li>
                </ul>

                <h3>Conclusão: Velocidade é Investimento, não Custo</h3>
                <p>Encare a performance do seu site como um investimento direto no seu faturamento e na reputação da sua marca. Um site otimizado e rápido não só agrada ao Google, mas, principalmente, agrada ao seu cliente, transformando visitantes em compradores satisfeitos.</p>

                <div class="cta-final">
                    <p>Seu site atual está lento e você sente que está perdendo clientes? Ofereço um serviço de diagnóstico e otimização de performance para colocar seu negócio de volta à velocidade máxima. Peça uma análise gratuita.</p>
                </div>
            `
        },
        article3: {
            title: '3 Sinais claros de que seu site precisa de uma reforma urgente',
            body: `
                <p>Pense no seu site como seu vendedor 24/7. Mas, e se esse vendedor estivesse usando roupas dos anos 90, falando de forma confusa e não conseguisse fechar um negócio? Ele estaria mais atrapalhando do que ajudando.</p>
                <p>O mesmo vale para um site desatualizado. Aqui estão 3 sinais de que seu "vendedor digital" precisa de uma reforma estratégica.</p>

                <h3>Sinal #1: Ele não funciona (ou funciona mal) no celular.</h3>
                <p>Abra seu site no seu smartphone agora mesmo. Você precisa dar zoom para conseguir ler? Os botões são pequenos demais para tocar? Alguns elementos quebram ou se sobrepõem? Se a resposta for sim, você tem um problema grave.</p>
                <p>Hoje, a maioria dos acessos à internet vem de dispositivos móveis. Se o seu site não oferece uma experiência perfeita no celular, você está ignorando a maior parte do seu público e passando uma imagem de que sua empresa não se modernizou.</p>

                <h3>Sinal #2: O design parece "parado no tempo".</h3>
                <p>Design não é só estética, é <strong>transmissão de confiança</strong>. Um site com aparência antiga, com fontes difíceis de ler, imagens de baixa qualidade e uma estrutura confusa, gera desconfiança instantânea no visitante.</p>
                <p>As pessoas julgam a qualidade do seu serviço pela qualidade do seu "cartão de visitas" digital. Se ele parece amador, por que seu trabalho seria diferente? Um design limpo, moderno e profissional é essencial para que os clientes levem sua marca a sério e se sintam seguros para fazer negócio com você.</p>
                
                <h3>Sinal #3: Ele é um "fantasma digital" (não gera contatos ou vendas).</h3>
                <p>Este é o teste final. Um site deve ser uma ferramenta de negócios ativa. Se o seu site está no ar há meses (ou anos) e nunca gerou um contato relevante, uma ligação ou uma venda, ele não está cumprindo sua função. Ele é apenas um custo.</p>
                <p>Geralmente, isso acontece por falta de estratégia: falta de chamadas para ação (Call-to-Action) claras, navegação confusa ou uma proposta de valor que não fica evidente para o cliente.</p>

                <h3>Conclusão: Reformar é Investir em Crescimento</h3>
                <p>Se você reconheceu um um ou mais desses sinais, não se preocupe. É um problema comum, mas que custa caro quando ignorado. Uma reforma estratégica não se trata apenas de "mudar as cores", mas de repensar seu site para que ele se transforme de uma simples página online na sua mais poderosa ferramenta para atrair clientes e gerar crescimento.</p>

                <div class="cta-final">
                    <p>Identificou algum desses sinais no seu site? Vamos conversar sobre um plano de reforma estratégica que se alinhe aos seus objetivos de negócio e comece a gerar resultados de verdade.</p>
                </div>
            `
        }
    };


    /* ==========================================================================
       LÓGICA DO PRELOADER
       ========================================================================== */
    const preloader = document.getElementById('preloader');
    const logoTextSpan = document.getElementById('logo-text');
    const body = document.body;

    if (preloader && logoTextSpan) {
        body.classList.add('preloader-active');
        const logoText = "Everton.dev";
        let i = 0;

        function typeWriter() {
            if (i < logoText.length) {
                logoTextSpan.innerHTML += logoText.charAt(i);
                i++;
                setTimeout(typeWriter, 120);
            }
        }
        typeWriter();

        window.addEventListener('load', () => {
            setTimeout(() => {
                preloader.classList.add('hidden');
                body.classList.remove('preloader-active');
            }, 1800);
        });
    }

    /* ==========================================================================
       LÓGICA DA ANIMAÇÃO DE FUNDO (PARTICLES.JS)
       ========================================================================== */
    if (document.getElementById('particles-js')) {
        particlesJS("particles-js", {
            "particles": { "number": { "value": 80, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#334155" }, "shape": { "type": "circle" }, "opacity": { "value": 0.4, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1, "sync": false } }, "size": { "value": 3, "random": true }, "line_linked": { "enable": false }, "move": { "enable": true, "speed": 0.6, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false } },
            "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } },
            "retina_detect": true
        });
    }

    /* ==========================================================================
       LÓGICA DO MENU MOBILE (SIDEBAR)
       ========================================================================== */
    const navMenu = document.getElementById('nav-menu');
    const navToggle = document.getElementById('nav-toggle');

    if (navToggle && navMenu) {
        const closeMenu = () => navMenu.classList.remove('show-menu');

        navToggle.addEventListener('click', (event) => {
            event.stopPropagation();
            navMenu.classList.toggle('show-menu');
        });
        
        navMenu.addEventListener('click', (event) => {
            if (event.target.classList.contains('nav__link')) {
                closeMenu();
            }
        });

        document.addEventListener('click', (event) => {
            const isClickInsideMenu = navMenu.contains(event.target);
            const isClickOnToggle = navToggle.contains(event.target);
            if (!isClickInsideMenu && !isClickOnToggle && navMenu.classList.contains('show-menu')) {
                closeMenu();
            }
        });
    }
    
    /* ==========================================================================
       LÓGICA DO DIAGNÓSTICO DIGITAL
       ========================================================================== */
    const diagnosisOptions = document.querySelectorAll('.diagnosis__questions .option');
    const diagnosisText = document.getElementById('diagnosis-text');
    const diagnosisCta = document.getElementById('diagnosis-cta');
    const userAnswers = {};
    const totalQuestions = 3;

    function generateDiagnosis() {
        if (Object.keys(userAnswers).length !== totalQuestions) return;

        let text = "<b>Diagnóstico:</b> ";
        if (userAnswers['1'] === 'nao-tenho') {
            text += "Você está no ponto de partida ideal. Um <b>Site Institucional</b> é o primeiro passo para estabelecer sua marca e gerar credibilidade.";
        } else if (userAnswers['2'] === 'lento' || userAnswers['2'] === 'nao-sei') {
            text += "Sua presença online pode estar sendo prejudicada. A solução é um <b>design 100% responsivo e otimizado para velocidade</b>.";
        } else if (userAnswers['3'] === 'raramente' || userAnswers['3'] === 'nunca' || userAnswers['1'] === 'tenho-insatisfeito') {
            text += "Seu site não está funcionando como ferramenta de negócios. Precisamos focar em uma <b>Landing Page de Alta Conversão</b> ou reestruturar seu site atual.";
        } else {
            text += "Sua base digital é boa, mas sempre há espaço para otimizar! Podemos melhorar a estratégia de conversão para <b>aumentar ainda mais seus resultados</b>.";
        }
        
        diagnosisText.innerHTML = text;
        if (diagnosisCta) {
            diagnosisCta.classList.add('visible');
        }
    }

    diagnosisOptions.forEach(option => {
        option.addEventListener('click', () => {
            const parentCard = option.closest('.question__card');
            if (!parentCard) return;

            const questionNumber = parentCard.dataset.question;
            userAnswers[questionNumber] = option.dataset.value;

            parentCard.querySelectorAll('.option').forEach(btn => btn.classList.remove('selected'));
            option.classList.add('selected');
            
            generateDiagnosis();
        });
    });

    /* ==========================================================================
       LÓGICA DO MODAL DO BLOG
       ========================================================================== */
    const blogLinks = document.querySelectorAll('.blog__link');
    const modal = document.getElementById('blog-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalCloseBtn = document.querySelector('.modal__close');

    const openModal = (articleId) => {
        const article = articleContents[articleId];
        if (!article) return;

        modalTitle.textContent = article.title;
        modalBody.innerHTML = article.body;
        modal.classList.add('modal--open');
        document.body.classList.add('modal-open-body-lock');
    };

    const closeModal = () => {
        modal.classList.remove('modal--open');
        document.body.classList.remove('modal-open-body-lock');
    };

    blogLinks.forEach(link => {
        link.addEventListener('click', (event) => {
            event.preventDefault();
            const articleId = link.dataset.article;
            openModal(articleId);
        });
    });

    if(modal) {
        modalCloseBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });
        window.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && modal.classList.contains('modal--open')) {
                closeModal();
            }
        });
    }


    /* ==========================================================================
       LÓGICA DE SCROLL (HEADER, ACTIVE LINKS, SCROLL-UP)
       ========================================================================== */
    const header = document.getElementById('header');
    const scrollUp = document.getElementById('scroll-up');
    const whatsAppButton = document.getElementById('whatsapp-float-button');
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav__menu a[href^="#"]');

    const handleScroll = () => {
        const scrollY = window.scrollY;
        // O valor 58 é um offset para compensar a altura do header. Pode ser ajustado se necessário.
        const scrollThreshold = scrollY + 58; 

        let currentSectionId = null;

        // Itera sobre as seções para encontrar a última que passou do topo da tela
        sections.forEach(section => {
            if (section.offsetTop <= scrollThreshold) {
                currentSectionId = section.getAttribute('id');
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active-link');
            const linkHref = link.getAttribute('href');
            
            if (linkHref === '#' + currentSectionId) {
                link.classList.add('active-link');
            }
        });
    };

    function throttle(func, limit) {
        let inThrottle;
        return function() {
            const args = arguments;
            const context = this;
            if (!inThrottle) {
                func.apply(context, args);
                inThrottle = true;
                setTimeout(() => inThrottle = false, limit);
            }
        }
    }
    
    window.addEventListener('scroll', throttle(handleScroll, 100));

    /* ==========================================================================
       LÓGICA DO OBSERVER PARA ANIMAÇÕES AO SCROLLAR
       ========================================================================== */
    const animatedElements = document.querySelectorAll('.section__header, .about__container, .project-card, .service__card, .testimonial__card, .blog__card, .diagnosis__container, .contact__form, .academic__item');
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });

    animatedElements.forEach((el) => {
        el.classList.add('animated-element');
        observer.observe(el);
    });
});
